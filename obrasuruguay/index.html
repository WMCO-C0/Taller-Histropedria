<!DOCTYPE html> <!-- Declaramos HTML5 -->
<html lang="es"> <!-- Documento en español -->
<head> <!-- Cabecera del documento -->
  <meta charset="UTF-8"> <!-- Codificación UTF-8 -->
  <title>Arte de dominio público en Uruguay – Histropedia + Wikidata</title> <!-- Título de la pestaña -->

  <!-- Fuente principal del diseño -->
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    /* Paleta tipo "nota adhesiva" suave */
    :root {
      --bg: #0f172a;           /* Fondo general oscuro */
      --card: #0b1120;         /* Fondo del contenedor de la timeline */
      --text: #e5e7eb;         /* Color de texto por defecto */
      --accent: #facc15;       /* Amarillo adhesivo */
      --accent-soft: #fef3c7;  /* Amarillo muy suave */
    }

    * { box-sizing: border-box; } /* Incluimos borde/padding en las medidas */

    body {
      margin: 0;                                  /* Quitamos márgenes */
      min-height: 100vh;                          /* Alto mínimo: pantalla completa */
      font-family: "Space Grotesk", sans-serif;   /* Tipografía base */
      background:
        radial-gradient(circle at 10% 10%, rgba(250, 204, 21, 0.14), transparent 40%),
        radial-gradient(circle at 90% 0%, rgba(96, 165, 250, 0.12), transparent 40%),
        var(--bg);                                /* Fondo con degradados */
      color: var(--text);                         /* Color de texto */
      display: flex;                              /* Centramos contenido */
      align-items: center;
      justify-content: center;
      padding: 40px 20px;                         /* Espaciado externo */
      overflow-x: hidden;                         /* Sin scroll horizontal */
    }

    .shell {
      width: min(1100px, 100%);                   /* Max 1100px, pero responsive */
      display: grid;                              /* Grid simple */
      gap: 20px;                                  /* Separación entre filas */
      text-align: center;                         /* Título centrado */
    }

    h1 {
      margin: 0;                                  /* Sin margen superior */
      font-size: clamp(26px, 3vw, 34px);          /* Tamaño flexible */
      letter-spacing: 0.02em;                     /* Un poco de tracking */
    }

    p.lead {
      margin: 8px 0 0;                            /* Margen pequeño */
      font-size: 14px;                            /* Tamaño de texto */
      opacity: 0.92;                              /* Ligero desvanecido */
    }

    .card {
      background: var(--card);                    /* Fondo del recuadro */
      border: 1px solid rgba(248, 250, 252, 0.16);/* Borde suave */
      border-radius: 18px;                        /* Bordes redondeados */
      padding: 22px;                              /* Relleno interno */
      box-shadow: 0 18px 50px rgba(0, 0, 0, 0.75);/* Sombra marcada */
    }

    #timeline {
      width: 100%;                                /* Ocupa todo el ancho */
      height: 480px;                              /* Alto del canvas */
      border-radius: 12px;                        /* Bordes redondeados */
      overflow: hidden;                           /* Oculta desbordes */
      border: 1px solid rgba(250, 204, 21, 0.35); /* Borde amarillo suave */
      background:
        linear-gradient(135deg, #020617 0%, #111827 40%, #0b1120 100%); /* Fondo oscuro */
    }
  </style> <!-- Fin del bloque de estilos -->
</head>

<body> <!-- Cuerpo principal de la página -->
  <main class="shell"> <!-- Contenedor con grid -->
    <div> <!-- Bloque de título y descripción -->
      <h1>Taller: Wikidata → SPARQL → HistropediaJS</h1> <!-- Título principal -->
      <p class="lead">
        Línea de tiempo de <strong>obras en dominio público vinculadas a Uruguay</strong>,
        mostradas como tarjetas tipo <em>nota adhesiva</em>.
      </p> <!-- Descripción corta -->
    </div>

    <div class="card"> <!-- Caja que contiene la timeline -->
      <div id="timeline"></div> <!-- Contenedor donde Histropedia dibuja el canvas -->
    </div>
  </main>

  <!-- ========== DEPENDENCIAS ========== -->

  <!-- jQuery (requerido por HistropediaJS) -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

  <!-- Plugin jQuery Mousewheel para soporte de scroll/zoom -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js"></script>

  <!-- Librería principal de HistropediaJS -->
  <script src="https://cdn.histropedia.com/histropedia-1.2.0.min.js"></script>

  <!-- ========== CÓDIGO DE LA TIMELINE ========== -->
  <script>
    // 1. ESTILOS DE TARJETA (NOTE STYLE)

    // Estilo base: simulamos una nota adhesiva rectangular
    const NOTE_STYLE = {
      color: '#fef3c7',                        // Fondo amarillo claro de la nota
      width: 190,                              // Ancho de la tarjeta
      topRadius: 4,                            // Esquinas suavemente redondeadas
      maxImageHeight: 200,                     // Altura máxima para la imagen (cuando exista)

      header: {                                // Usamos el header como área principal del texto
        height: 70,                            // Alto bastante grande para simular la nota
        text: {
          font: "600 14px 'Space Grotesk', sans-serif", // Fuente en negrita para el título
          color: "#78350f",                    // Marrón oscuro legible sobre amarillo
          align: "left",                       // Alineado a la izquierda
          baseline: "top",                     // Ancla en la parte superior
          margin: 10,                          // Margen interno
          lineHeight: 18,                      // Altura de línea
          numberOfLines: 3                     // Hasta tres líneas de título
        }
      },

      subheader: {                             // Ocultamos el subheader poniéndole height 0
        height: 0,                             // Truco de la documentación para no dibujarlo
        color: '#000',                         // Color irrelevante: no se verá
        text: {
          font: "400 11px 'Space Grotesk', sans-serif",
          color: "#000",
          align: "left",
          baseline: "middle",
          margin: 0
        }
      },

      shadow: {                                // Sombra suave tipo "nota pegada a la pared"
        x: 0,
        y: 4,
        amount: 14,
        color: 'rgba(0, 0, 0, 0.4)'
      },

      border: {                                // Borde sutil de la nota
        color: '#facc15',
        width: 2
      },

      connectorLine: {                         // Línea de conexión muy fina
        offsetX: 18,
        offsetY: -18,
        thickness: 1,
        arrow: {
          width: 14,
          height: 45
        }
      }
    };

    // Estilo activo: nota un poco más naranja, como si estuviera resaltada
    const NOTE_ACTIVE_STYLE = {
      color: '#fde68a',                        // Fondo ligeramente más intenso
      header: {
        text: {
          color: '#7c2d12'                     // Texto un poco más oscuro
        }
      },
      border: {
        color: '#f97316',
        width: 3
      },
      shadow: {
        x: 0,
        y: 8,
        amount: 20,
        color: 'rgba(0, 0, 0, 0.7)'
      }
    };

    // 2. INICIALIZACIÓN DE LA TIMELINE

    const container = document.getElementById('timeline'); // Div del canvas

    // Creamos la timeline de Histropedia
    const timeline = new Histropedia.Timeline(container, {
      width: container.clientWidth,           // Ancho inicial: ocupa toda la tarjeta
      height: 480,                            // Alto definido en CSS
      verticalOffset: 40,                     // Posición vertical del eje de tiempo

      zoom: {                                 // Configuración de zoom
        initial: 28,                          // Nivel inicial (un poco más alejado)
        minimum: 0,
        maximum: 120,
        wheelStep: 0.1,
        wheelSpeed: 3
      },

      style: {                                // Estilos del eje temporal
        mainLine: {
          visible: true,
          size: 8
        },
        marker: {
          minor: {
            height: 10,
            color: "#64748b",
            futureColor: "#64748b"
          },
          major: {
            height: 26,
            color: "#facc15",
            futureColor: "#facc15"
          }
        },
        dateLabel: {
          minor: {
            font: "400 10px 'Space Grotesk'",
            color: "#cbd5f5",
            textAlign: "start",
            offset: { x: 4, y: 0 }
          },
          major: {
            font: "600 15px 'Space Grotesk'",
            color: "#facc15",
            textAlign: "start",
            offset: { x: 4, y: 0 }
          }
        }
      },

      article: {                              // Opciones relacionadas con las tarjetas
        density: Histropedia.DENSITY_ALL,
        draggable: true,                      // Permite arrastrar artículos
        distanceToMainLine: 360,             // Distancia de las notas al eje
        autoStacking: {
          active: true,
          rowSpacing: 60,
          range: Histropedia.RANGE_ALL,
          fitToHeight: true,
          topGap: 10
        },
        animation: {
          move: {
            active: true,
            duration: 1300,
            easing: "swing"
          },
          fade: {
            active: true,
            duration: 1300,
            easing: "swing"
          }
        },
        defaultStyle: NOTE_STYLE,             // Estilo por defecto de las notas
        defaultActiveStyle: NOTE_ACTIVE_STYLE // Estilo al activarse
      }
    });

    // Función de ayuda para reajustar el tamaño cuando se cambia el ancho de ventana
    const syncSize = () => {
      const w = container.clientWidth;        // Ancho actual del contenedor
      const h = 480;                          // Alto fijo
      if (typeof timeline.setSize === 'function') {
        timeline.setSize(w, h);               // Método preferido
      } else if (typeof timeline.resize === 'function') {
        timeline.resize(w, h);                // Alternativa si la versión lo usa
      }
    };

    // Conectamos la función de redimensionamiento al evento resize
    window.addEventListener('resize', syncSize);

    // 3. CONSULTA SPARQL Y CARGA DE DATOS DESDE WIKIDATA

    async function loadUruguayArtTimeline() {
      const endpointUrl = 'https://query.wikidata.org/sparql'; // Endpoint SPARQL
      const YEAR_PRECISION = Histropedia.PRECISION_YEAR || Histropedia.PRECISION_DAY;

      // Cadena SPARQL que busca obras en dominio público relacionadas con Uruguay
      const sparql = `
      # Obras de arte (pinturas y esculturas) en dominio público - Uruguay
      SELECT DISTINCT ?work ?workLabel ?inception ?image ?museumLabel WHERE {
        ?work wdt:P31/wdt:P279* ?type .
        VALUES ?type { wd:Q3305213 wd:Q860861 }  # pintura, escultura

        {
          ?work wdt:P495 wd:Q77 .                # país de origen: Uruguay
        }
        UNION
        {
          ?work wdt:P195 ?museum .               # en colección de un museo
          ?museum wdt:P17 wd:Q77 .              # cuyo país es Uruguay
        }

        ?work wdt:P6216 wd:Q19652 .              # dominio público

        OPTIONAL { ?work wdt:P571 ?inception . } # fecha de creación
        OPTIONAL { ?work wdt:P18  ?image . }     # imagen
        OPTIONAL { ?work wdt:P195 ?museum . }    # museo

        SERVICE wikibase:label { bd:serviceParam wikibase:language "es,en". }
      }
      ORDER BY ?inception ?workLabel
      LIMIT 200
      `;

      // Construimos la URL con la query codificada
      const url = endpointUrl + '?query=' + encodeURIComponent(sparql) + '&format=json&origin=*';

      // Llamamos al endpoint esperando resultado JSON
      const response = await fetch(url, {
        headers: { 'Accept': 'application/sparql-results+json' }
      });

      const data = await response.json();          // Parseamos el JSON

      // Transformamos cada fila en un artículo Histropedia
      const articles = data.results.bindings
        .filter(row => row.inception)              // Solo usamos obras con fecha de creación
        .map((row, idx) => {
          const rawDate = row.inception.value.split('T')[0]; // Cortamos a YYYY-MM-DD
          const [yearStr] = rawDate.split('-');    // Tomamos solo el año
          const year = Number(yearStr);            // Lo convertimos a número

          // Definimos la fecha de inicio del evento
          const from = {
            year: year,
            month: 1,
            day: 1,
            precision: YEAR_PRECISION
          };

          // Subtítulo: nombre del museo o texto genérico
          const museo = row.museumLabel ? row.museumLabel.value : 'Colección no especificada';

          return {
            id: idx + 1,                            // ID único
            title: row.workLabel.value,             // Título de la obra
            subtitle: museo,                        // Museo asociado
            from: from,                             // Fecha de inicio
            to: null,                               // Sin fecha de fin
            imageUrl: row.image ? row.image.value : null // Imagen si existe
          };
        });

      // Cargamos los artículos en la timeline
      timeline.load(articles);

      // Volvemos a ajustar el tamaño
      syncSize();
    }

    // Ejecutamos la función al cargar la página
    loadUruguayArtTimeline();
  </script> <!-- Fin del script principal -->
</body> <!-- Fin del cuerpo -->
</html> <!-- Fin del documento -->
