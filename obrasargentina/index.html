<!DOCTYPE html> <!-- Declaramos que el documento usa HTML5 -->
<html lang="es"> <!-- Documento HTML en idioma español -->
<head> <!-- Inicio de la cabecera con metadatos y estilos -->
  <meta charset="UTF-8"> <!-- Codificación UTF-8 para soportar acentos -->
  <title>Arte de dominio público en Argentina – Histropedia + Wikidata</title> <!-- Título de la pestaña -->

  <!-- Fuente Google que usamos para todo el diseño -->
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    /* Variables de color base para este ejemplo (estética "afiche moderno") */
    :root {
      --bg: #020617;          /* Fondo general muy oscuro */
      --card: #020617;        /* Fondo del contenedor principal */
      --text: #e5e7eb;        /* Color de texto por defecto */
      --accent: #f97316;      /* Naranja para detalles */
      --accent-soft: #fed7aa; /* Naranja suave para degradados */
    }

    * { box-sizing: border-box; } /* Incluye padding y borde en el cálculo del ancho/alto */

    body {
      margin: 0;                                   /* Sin márgenes por defecto */
      min-height: 100vh;                           /* Ocupa al menos el alto de la ventana */
      font-family: "Space Grotesk", sans-serif;    /* Tipografía base */
      /* Dos degradados radiales para textura de fondo */
      background:
        radial-gradient(circle at 15% 15%, rgba(249, 115, 22, 0.20), transparent 45%),
        radial-gradient(circle at 85% 0%, rgba(56, 189, 248, 0.18), transparent 40%),
        var(--bg);
      color: var(--text);                          /* Color del texto */
      display: flex;                               /* Centramos el contenido */
      align-items: center;
      justify-content: center;
      padding: 40px 20px;                          /* Respira por los bordes */
      overflow-x: hidden;                          /* Evita scroll horizontal */
    }

    .shell {
      width: min(1100px, 100%); /* Máximo 1100px, pero adaptable a pantallas pequeñas */
      display: grid;            /* Layout en grid simple */
      gap: 20px;                /* Separación entre filas */
      text-align: center;       /* Títulos centrados */
    }

    h1 {
      margin: 0;                                        /* Sin margen superior */
      font-size: clamp(26px, 3vw, 34px);                /* Tamaño fluido según ancho de pantalla */
      letter-spacing: 0.02em;                           /* Un poco de espaciado entre letras */
    }

    p.lead {
      margin: 8px 0 0;                                  /* Margen pequeño para el párrafo introductorio */
      font-size: 14px;
      opacity: 0.9;                                     /* Ligero desvanecido */
    }

    .card {
      background: var(--card);                          /* Misma base que el fondo principal */
      border: 1px solid rgba(248, 250, 252, 0.16);      /* Borde sutil */
      border-radius: 18px;                              /* Bordes redondeados */
      padding: 22px;                                    /* Espaciado interno */
      box-shadow: 0 22px 60px rgba(0, 0, 0, 0.75);      /* Sombra pronunciada */
    }

    #timeline {
      width: 100%;                                     /* Ocupa todo el ancho disponible */
      height: 480px;                                   /* Alto fijo de la timeline */
      border-radius: 12px;                             /* Bordes redondeados para el canvas */
      overflow: hidden;                                /* Oculta cualquier desbordamiento */
      border: 1px solid rgba(248, 250, 252, 0.22);     /* Borde visible alrededor de la timeline */
      /* Degradado de fondo detrás del canvas */
      background:
        linear-gradient(135deg, #020617 0%, #111827 40%, #0b1120 100%);
    }
  </style> <!-- Fin de estilos -->
</head> <!-- Fin de la cabecera -->

<body> <!-- Inicio del cuerpo visible de la página -->
  <main class="shell"> <!-- Contenedor principal con grid -->
    <div> <!-- Bloque superior con título y texto de contexto -->
      <h1>Taller: Wikidata → SPARQL → HistropediaJS</h1> <!-- Título principal -->
      <p class="lead">
        Línea de tiempo de <strong>obras de arte en dominio público originarias de Argentina</strong>,
        usando su fecha de creación y datos abiertos de Wikidata.
      </p> <!-- Descripción corta del ejemplo -->
    </div>

    <div class="card"> <!-- Tarjeta visual que envuelve la timeline -->
      <div id="timeline"></div> <!-- Div donde HistropediaJS dibujará el canvas -->
    </div>
  </main>

  <!-- ========= DEPENDENCIAS JAVASCRIPT ========= -->

  <!-- jQuery, requerido por HistropediaJS -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

  <!-- Plugin jQuery Mousewheel, necesario para zoom con la rueda del ratón -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js"></script>

  <!-- Librería principal de HistropediaJS (desde el CDN oficial) -->
  <script src="https://cdn.histropedia.com/histropedia-1.2.0.min.js"></script>

  <!-- ========= CÓDIGO DEL TALLER ========= -->
  <script>
    // -----------------------------
    // 1. Definimos estilos de las tarjetas (event cards)
    // -----------------------------

    // Estilo base de las tarjetas para este ejemplo (inspirado en un "afiche moderno")
    const ARTICLE_STYLE = {
      color: '#f9fafb',                     // Color de fondo principal de la tarjeta
      width: 210,                           // Ancho en píxeles de cada tarjeta
      topRadius: 14,                        // Radio de las esquinas superiores (más redondeadas)
      maxImageHeight: 260,                  // Altura máxima permitida para la imagen

      header: {                             // Zona del título
        height: 54,                         // Alto fijo de la franja del título
        text: {
          font: "600 14px 'Space Grotesk', sans-serif", // Fuente y tamaño del título
          color: "#111827",                 // Color del texto del título
          align: "left",                    // Alineación horizontal del texto
          baseline: "middle",               // Alineación vertical (centrado)
          margin: 12,                       // Margen interno alrededor del texto
          lineHeight: 18,                   // Altura de línea para títulos de varias líneas
          numberOfLines: 2                  // Máximo de líneas de título visibles
        }
      },

      subheader: {                          // Franja debajo del título, usamos museo / estilo
        height: 32,                         // Alto de la banda de subtítulo
        color: '#0f172a',                   // Color de fondo de la banda
        text: {
          font: "400 11px 'Space Grotesk', sans-serif", // Fuente de subtítulo
          color: "#f9fafb",                 // Color del texto de subtítulo
          align: "left",
          baseline: "middle",
          margin: 12
        }
      },

      shadow: {                             // Sombra de la tarjeta
        x: 0,                               // Desplazamiento horizontal de la sombra
        y: 6,                               // Desplazamiento vertical
        amount: 18,                         // Desenfoque / intensidad
        color: 'rgba(15, 23, 42, 0.8)'      // Color semitransparente de la sombra
      },

      border: {                             // Borde exterior de la tarjeta
        color: '#f97316',                   // Color naranja del borde
        width: 2                            // Grosor del borde
      },

      connectorLine: {                      // Línea que conecta la tarjeta con el eje temporal
        offsetX: 26,                        // Separación horizontal desde el borde de la tarjeta
        offsetY: -24,                       // Separación vertical hacia el eje
        thickness: 2,                       // Grosor de la línea
        arrow: {
          width: 18,                        // Anchura de la punta de flecha
          height: 60                        // Altura / longitud de la flecha
        }
      }
    };

    // Estilo cuando una tarjeta está "activa" (seleccionada / clicada)
    const ACTIVE_STYLE = {
      color: '#0f172a',                     // Fondo más oscuro cuando está activa
      header: {
        text: {
          color: '#fed7aa'                  // Título en naranja suave al activarse
        }
      },
      subheader: {
        color: '#f97316',                   // Banda de subtítulo naranja al activarse
        text: {
          color: '#0b1120'                  // Texto del subtítulo en oscuro para contraste
        }
      },
      border: {
        color: '#fed7aa',                   // Borde más claro en estado activo
        width: 3
      },
      shadow: {
        x: 0,
        y: 10,                              // Sombra más larga para dar sensación de “flotar”
        amount: 24,
        color: 'rgba(0, 0, 0, 0.9)'
      }
    };

    // -----------------------------
    // 2. Inicializamos la timeline de Histropedia
    // -----------------------------

    const container = document.getElementById('timeline'); // Obtenemos el div donde irá la timeline

    // Creamos una nueva instancia de Histropedia.Timeline
    const timeline = new Histropedia.Timeline(container, {
      width: container.clientWidth,         // Ancho inicial: igual al ancho del contenedor
      height: 480,                          // Alto fijo definido en el CSS
      verticalOffset: 40,                   // Distancia entre el eje y la parte superior del canvas

      // Configuración del zoom (usamos valores cercanos al default)
      zoom: {
        initial: 30,                        // Nivel de zoom inicial (más bajo = más rango visible)
        minimum: 0,                         // Zoom mínimo permitido
        maximum: 120,                       // Zoom máximo permitido
        wheelStep: 0.1,                     // Pasos de zoom por evento de rueda
        wheelSpeed: 3                       // Velocidad de zoom
      },

      // Estilos generales de la línea de tiempo
      style: {
        mainLine: {
          visible: true,                    // Mostramos la línea principal
          size: 8                           // Grosor de la línea principal
        },
        marker: {                           // Estilos de las marcas de los años
          minor: {
            height: 14,                     // Altura de las marcas menores
            color: "#94a3b8",               // Color gris azulado
            futureColor: "#64748b"          // Color para fechas futuras (no usaremos mucho aquí)
          },
          major: {
            height: 30,                     // Altura de las marcas principales
            color: "#f97316",               // Color naranja para ticks principales
            futureColor: "#cbd5f5"
          }
        },
        dateLabel: {                        // Estilo de los textos de año / fecha
          minor: {
            font: "400 10px 'Space Grotesk'", // Fuente de etiquetas menores
            color: "#cbd5f5",                // Color suave
            textAlign: "start",              // Alineación del texto respecto al tick
            offset: { x: 4, y: 0 }           // Desplazamiento leve a la derecha
          },
          major: {
            font: "600 16px 'Space Grotesk'", // Fuente de etiquetas principales
            color: "#fed7aa",                 // Color de texto principal
            textAlign: "start",
            offset: { x: 4, y: 2 }
          }
        }
      },

      // Configuraciones relacionadas con las tarjetas (articles)
      article: {
        density: Histropedia.DENSITY_ALL,   // Mostrar todos los artículos
        draggable: true,                    // Permitir arrastrar las tarjetas
        distanceToMainLine: 380,            // Distancia vertical desde la línea temporal
        autoStacking: {                     // Auto-apilamiento para evitar solapes
          active: true,                     // Activar auto-stacking
          rowSpacing: 65,                   // Espacio vertical entre filas de tarjetas
          range: Histropedia.RANGE_ALL,     // Aplica a todas las tarjetas
          fitToHeight: true,                // Ajusta las filas al alto disponible
          topGap: 10                        // Margen superior
        },
        periodLine: {                       // Línea que une inicios/fin (no la usamos mucho aquí)
          defaultHide: false                // La dejamos visible por defecto
        },
        animation: {                        // Animaciones al cargar elementos
          move: {
            active: true,
            duration: 1400,                 // Duración del movimiento en ms
            easing: "swing"                 // Tipo de curva de animación
          },
          fade: {
            active: true,
            duration: 1400,
            easing: "swing"
          }
        },
        defaultStyle: ARTICLE_STYLE,        // Estilo base para todas las tarjetas
        defaultActiveStyle: ACTIVE_STYLE    // Estilo cuando están activas
      }
    });

    // Función para ajustar el tamaño de la timeline cuando cambie el ancho de la ventana
    const syncSize = () => {
      const w = container.clientWidth;      // Calculamos el ancho actual del contenedor
      const h = 480;                        // Alto fijo
      // HistropediaJS puede exponer setSize o resize según la versión
      if (typeof timeline.setSize === 'function') {
        timeline.setSize(w, h);             // Si existe setSize, la usamos
      } else if (typeof timeline.resize === 'function') {
        timeline.resize(w, h);              // Alternativa en otras versiones
      }
    };

    // Escuchamos el evento de cambio de tamaño de ventana para volver a ajustar la timeline
    window.addEventListener('resize', syncSize);

    // -----------------------------
    // 3. Función que consulta Wikidata (SPARQL) y carga los artículos
    // -----------------------------

    async function loadArgentinaArtTimeline() {
      const endpointUrl = 'https://query.wikidata.org/sparql'; // URL del endpoint SPARQL oficial
      const YEAR_PRECISION = Histropedia.PRECISION_YEAR || Histropedia.PRECISION_DAY; // Precisión de año

      // Consulta SPARQL: misma que el archivo .rq anterior, incrustada como cadena
      const sparql = `
      # Obras de arte (pinturas y esculturas) en dominio público - Argentina
      SELECT DISTINCT ?work ?workLabel ?inception ?image ?genreLabel ?movementLabel WHERE {
        ?work wdt:P31/wdt:P279* ?type .
        VALUES ?type { wd:Q3305213 wd:Q860861 }  # pintura, escultura

        ?work wdt:P495 wd:Q414 .                 # país de origen: Argentina
        ?work wdt:P6216 wd:Q19652 .              # estado de copyright: dominio público

        OPTIONAL { ?work wdt:P571 ?inception . } # fecha de creación
        OPTIONAL { ?work wdt:P18  ?image . }     # imagen
        OPTIONAL { ?work wdt:P136 ?genre . }     # género artístico
        OPTIONAL { ?work wdt:P135 ?movement . }  # movimiento artístico

        SERVICE wikibase:label { bd:serviceParam wikibase:language "es,en". }
      }
      ORDER BY ?inception ?workLabel
      LIMIT 200
      `;

      // Construimos la URL completa con la query codificada y parámetros para CORS
      const url = endpointUrl + '?query=' + encodeURIComponent(sparql) + '&format=json&origin=*';

      // Llamamos al endpoint usando fetch y pedimos el resultado en formato JSON
      const response = await fetch(url, {
        headers: { 'Accept': 'application/sparql-results+json' } // Indicamos tipo de respuesta deseado
      });

      const data = await response.json(); // Convertimos la respuesta en objeto JS

      // Transformamos cada fila del resultado SPARQL en un "article" para Histropedia
      const articles = data.results.bindings
        .filter(row => row.inception)      // Nos quedamos sólo con obras que tengan fecha de creación
        .map((row, idx) => {               // Mapear cada fila a un objeto artículo
          const rawDate = row.inception.value.split('T')[0]; // Nos quedamos con la parte de fecha (YYYY-MM-DD)
          const [yearStr] = rawDate.split('-');              // Extraemos el año como string
          const year = Number(yearStr);                      // Convertimos a número

          // Definimos la fecha "from" del artículo (inicio del evento)
          const from = {
            year: year,                     // Año de creación
            month: 1,                       // Mes genérico (no siempre lo tenemos)
            day: 1,                         // Día genérico
            precision: YEAR_PRECISION       // Precisión de año
          };

          // Construimos el subtítulo combinando género y movimiento si existen
          const genre = row.genreLabel ? row.genreLabel.value : null;
          const movement = row.movementLabel ? row.movementLabel.value : null;
          let subtitleText = "Obra de arte en dominio público"; // Texto por defecto

          if (genre && movement) {          // Si tenemos género y movimiento
            subtitleText = `${genre} · ${movement}`;
          } else if (genre) {               // Sólo género
            subtitleText = genre;
          } else if (movement) {            // Sólo movimiento
            subtitleText = movement;
          }

          // Devolvemos el objeto artículo listo para la timeline
          return {
            id: idx + 1,                    // ID único creciente para cada obra
            title: row.workLabel.value,     // Título de la obra
            subtitle: subtitleText,         // Subtítulo construido arriba
            from: from,                     // Fecha de inicio
            to: null,                       // No definimos fecha de fin
            imageUrl: row.image ? row.image.value : null // URL de imagen si existe
          };
        });

      // Cargamos los artículos en la timeline
      timeline.load(articles);

      // Reajustamos tamaño por si el canvas ha cambiado
      syncSize();
    }

    // Llamamos a la función para cargar la timeline al abrir la página
    loadArgentinaArtTimeline();
  </script> <!-- Fin del script principal -->
</body> <!-- Fin del cuerpo -->
</html> <!-- Fin del documento HTML -->
