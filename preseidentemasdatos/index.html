<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Presidentes de Colombia – Wikidata + HistropediaJS</title>

  <!-- Fuente para el diseño (opcional, pero queda bonito) -->
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #020617;
      --card: #020617;
      --text: #e5e7eb;
      --accent: #38bdf8;
      --accent-soft: #a5f3fc;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Space Grotesk", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background:
        radial-gradient(circle at 15% 15%, rgba(56, 189, 248, 0.14), transparent 45%),
        radial-gradient(circle at 85% 0%, rgba(59, 130, 246, 0.18), transparent 40%),
        var(--bg);
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
      overflow-x: hidden;
    }

    .shell {
      width: min(1100px, 100%);
      display: grid;
      gap: 20px;
      text-align: center;
    }

    h1 {
      margin: 0;
      font-size: clamp(26px, 3vw, 34px);
      letter-spacing: 0.03em;
    }

    p.lead {
      margin: 8px 0 0;
      font-size: 14px;
      opacity: 0.92;
    }

    .card {
      background: var(--card);
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      padding: 22px;
      box-shadow: 0 22px 60px rgba(0, 0, 0, 0.75);
    }

    #timeline {
      width: 100%;
      height: 480px;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: linear-gradient(135deg, #020617 0%, #0b1120 40%, #020617 100%);
    }

    .hint {
      font-size: 12px;
      opacity: 0.85;
      margin-top: 6px;
    }
  </style>
</head>
<body>
  <main class="shell">
    <div>
      <h1>Presidentes de Colombia · Wikidata → HistropediaJS</h1>
      <p class="lead">
        Cada tarjeta muestra el periodo en el cargo, una breve descripción tomada de Wikidata
        y al hacer clic te lleva al ítem correspondiente.
      </p>
      <p class="hint">
        Puedes hacer zoom con la rueda del ratón y arrastrar la línea de tiempo.
      </p>
    </div>

    <div class="card">
      <div id="timeline"></div>
    </div>
  </main>

  <!-- ===== Dependencias ===== -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js"></script>
  <script src="https://cdn.histropedia.com/histropedia-1.2.0.min.js"></script>

  <script>
    // 1) Estilos de las tarjetas (event cards)
    const PRESIDENT_STYLE = {
      color: "#0f172a",
      width: 230,
      topRadius: 14,
      maxImageHeight: 220, // retratos

      header: {
        height: 52,
        text: {
          font: "600 14px 'Space Grotesk', sans-serif",
          color: "#e5e7eb",
          align: "left",
          baseline: "middle",
          margin: 12,
          lineHeight: 18,
          numberOfLines: 2
        }
      },

      // aquí mostramos la descripción corta de Wikidata
      subheader: {
        height: 64,
        color: "#020617",
        text: {
          font: "400 11px 'Space Grotesk', sans-serif",
          color: "#cbd5f5",
          align: "left",
          baseline: "middle",
          margin: 12,
          lineHeight: 14,
        }
      },

      shadow: {
        x: 0,
        y: 8,
        amount: 20,
        color: "rgba(0,0,0,0.9)"
      },

      border: {
        color: "#38bdf8",
        width: 2
      },

      connectorLine: {
        offsetX: 26,
        offsetY: -24,
        thickness: 2,
        arrow: {
          width: 18,
          height: 60
        }
      }
    };

    const PRESIDENT_ACTIVE_STYLE = {
      color: "#020617",
      header: {
        text: {
          color: "#f9fafb"
        }
      },
      subheader: {
        color: "#0ea5e9",
        text: {
          color: "#0b1120"
        }
      },
      border: {
        color: "#a5f3fc",
        width: 3
      },
      shadow: {
        x: 0,
        y: 12,
        amount: 26,
        color: "rgba(0,0,0,1)"
      }
    };

    // 2) Inicializar timeline
    const container = document.getElementById("timeline");

    const timeline = new Histropedia.Timeline(container, {
      width: container.clientWidth,
      height: 480,
      verticalOffset: 40,

      // evento: cuando haces clic en una tarjeta abre la URL de Wikidata
      onArticleClick: function (article) {
        const url = article.data.wikidataUrl; // campo custom que le vamos a meter al article
        if (url) {
          window.open(url, "_blank");
        }
      },

      zoom: {
        initial: 30,
        minimum: 0,
        maximum: 120,
        wheelStep: 0.1,
        wheelSpeed: 3
      },

      style: {
        mainLine: {
          visible: true,
          size: 8
        },
        marker: {
          minor: {
            height: 12,
            color: "#94a3b8",
            futureColor: "#64748b"
          },
          major: {
            height: 30,
            color: "#38bdf8",
            futureColor: "#93c5fd"
          }
        },
        dateLabel: {
          minor: {
            font: "400 10px 'Space Grotesk'",
            color: "#cbd5f5",
            textAlign: "start",
            offset: { x: 4, y: 0 }
          },
          major: {
            font: "600 16px 'Space Grotesk'",
            color: "#e0f2fe",
            textAlign: "start",
            offset: { x: 4, y: 0 }
          }
        }
      },

      article: {
        density: Histropedia.DENSITY_ALL,
        draggable: true,
        distanceToMainLine: 380,
        autoStacking: {
          active: true,
          rowSpacing: 65,
          range: Histropedia.RANGE_ALL,
          fitToHeight: true,
          topGap: 10
        },
        periodLine: {
          defaultHide: false
        },
        animation: {
          move: {
            active: true,
            duration: 1400,
            easing: "swing"
          },
          fade: {
            active: true,
            duration: 1400,
            easing: "swing"
          }
        },
        defaultStyle: PRESIDENT_STYLE,
        defaultActiveStyle: PRESIDENT_ACTIVE_STYLE
      }
    });

    // ajustar tamaño si cambia el ancho de la ventana
    const syncSize = () => {
      const w = container.clientWidth;
      const h = 480;
      if (typeof timeline.setSize === "function") {
        timeline.setSize(w, h);
      } else if (typeof timeline.resize === "function") {
        timeline.resize(w, h);
      }
    };
    window.addEventListener("resize", syncSize);

    // 3) Cargar datos desde Wikidata (presidentes de Colombia)
    async function loadPresidentsTimeline() {
      const endpointUrl = "https://query.wikidata.org/sparql";
      const DAY_PRECISION =
        Histropedia.PRECISION_DAY || Histropedia.PRECISION_YEAR;

      const sparql = `
      # Presidentes de Colombia (posición: President of Colombia Q853475)
      SELECT DISTINCT ?person ?personLabel ?personDescription ?start ?end ?image WHERE {
        ?person wdt:P31 wd:Q5 .            # humano
        ?person p:P39 ?statement .
        ?statement ps:P39 wd:Q853475 .     # cargo: Presidente de Colombia

        OPTIONAL { ?statement pq:P580 ?start. }  # inicio del mandato
        OPTIONAL { ?statement pq:P582 ?end. }    # fin del mandato
        OPTIONAL { ?person wdt:P18 ?image. }     # retrato

        SERVICE wikibase:label {
          bd:serviceParam wikibase:language "es,en".
        }
      }
      ORDER BY ?start ?personLabel
      `;

      const url =
        endpointUrl +
        "?query=" +
        encodeURIComponent(sparql) +
        "&format=json&origin=*";

      const response = await fetch(url, {
        headers: { Accept: "application/sparql-results+json" }
      });

      const data = await response.json();

      const articles = data.results.bindings
        .filter(row => row.start) // sólo quienes tienen fecha de inicio
        .map((row, idx) => {
          // ---- from (inicio del mandato) ----
          const startStr = row.start.value.split("T")[0]; // YYYY-MM-DD
          const [sy, sm, sd] = startStr.split("-").map(Number);
          const from = {
            year: sy,
            month: sm || 1,
            day: sd || 1,
            precision: DAY_PRECISION
          };

          // ---- to (fin del mandato, si existe) ----
          let to = null;
          let isToPresent = false;

          if (row.end) {
            const endStr = row.end.value.split("T")[0];
            const [ey, em, ed] = endStr.split("-").map(Number);
            to = {
              year: ey,
              month: em || 1,
              day: ed || 1,
              precision: DAY_PRECISION
            };
          } else {
            // presidente actual sin fecha de fin
            isToPresent = true;
          }

          // descripción corta de Wikidata (en es/en)
          const desc = row.personDescription
            ? row.personDescription.value
            : "Presidente de Colombia";

          // URL directa al ítem de Wikidata
          const wikidataUrl = row.person.value; // p.ej. https://www.wikidata.org/entity/Q704022

          return {
            id: idx + 1,
            title: row.personLabel.value,
            subtitle: desc,
            from,
            to,
            isToPresent,
            imageUrl: row.image ? row.image.value : null,
            wikidataUrl // campo custom para usar en onArticleClick
          };
        });

      timeline.load(articles);
      syncSize();
    }

    // Ejecutar carga al iniciar
    loadPresidentsTimeline();
  </script>
</body>
</html>
